source "git@code.amh-group.com:iOSYmm/mb-specrepo.git"
source "git@code.amh-group.com:cocoapods/mb-thirdpartyspecrepo.git"

use_frameworks! :linkage => :static

def mb_pod_post_install()
  post_install do |installer|
    installer.pods_project.targets.each do |target|
      target.build_configurations.each do |config|
        config.build_settings["HEADER_SEARCH_PATHS"] = ["$(inherited)", "$(BUILT_PRODUCTS_DIR)/$(CONTENTS_FOLDER_PATH)/Headers"]
        config.build_settings["ENABLE_BITCODE"] = "NO"
        config.build_settings["IPHONEOS_DEPLOYMENT_TARGET"] = "11.0"
        #                config.build_settings['GCC_PRECOMPILE_PREFIX_HEADER'] = 'NO'
        # Debug ä¸‹ä¸ä¸ç¼–è¯‘dsymï¼Œç”¨äºå‡å°‘è¿è¡Œæ—¶çš„ warning
        config.build_settings["DEBUG_INFORMATION_FORMAT"] = "dwarf"
        config.build_settings["DEVELOPMENT_TEAM"] = "33NTY77JS5"
        #                config.build_settings['CLANG_ENABLE_MODULES'] = 'NO'
        #                config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] = ['$(inherited)', 'DEBUG=1']
      end
    end
  end
end

mb_pod_post_install()

platform :ios, "11.0"
#use_frameworks! :linkage => :static

inhibit_all_warnings!
#use_frameworks!
use_modular_headers!

target "MBFoundation_Example" do
  pod "MBFoundation", path: "../", :inhibit_warnings => false
  
  target "MBFoundation_Tests" do
    inherit! :search_paths
    
#    pod "MBToolKit", git: "git@code.amh-group.com:iOSYmm/MBToolKit.git", branch: "test/20220113_Foundation"
    pod "Quick"
    pod "Nimble"
  end
end

# ğŸ‚ğŸº https://rubydoc.info/gems/cocoapods/Pod/Installer/
# æœ€å¤§çš„å¥½å¤„åœ¨äºå°†projectå’Œtargetä¹‹é—´çš„ä¾èµ–ç®¡ç†ã€é…ç½®å‚æ•°ç»§æ‰¿å…³ç³»
# æƒ³ä¸€ä¸‹å¦‚ä¸‹å‡ ç§æƒ…å†µ
# 1ã€å•projectå¤štargetï¼ˆä¾‹å¦‚æˆ‘ä»¬çš„å®¿ä¸»å·¥ç¨‹ï¼‰
# 2ã€å¤šprojectå¤štargetï¼ˆå°‘è§ï¼Œä½†ä¸æ˜¯ä¸å¯èƒ½ï¼‰
# 3ã€å•projectå¤šconfigurationï¼ˆå‡ ä¹æ˜¯å¿…ç„¶ï¼‰
# ......æ‰‹åŠ¨ç®€ç›´æ˜¯ä¸ªå™©æ¢¦
# ä½¿ç”¨ Cocoapods Installer åˆ™èµ‹äºˆäº†å¼ºå¤§çš„ç»“æ„åŒ–ã€å¯è§†åŒ–ã€æœ‰åºåŒ–çš„ç‰¹æ€§ï¼Œå†ä¹Ÿä¸å‘æ„è‚‰çœ¼å¯¹æ¯”ç„¶åæ‰‹åŠ¨ä¿®æ”¹projectæˆ–targetçš„ç¼–è¯‘é€‰é¡¹é…ç½®å‚æ•°äº†
# ä½ æœ€å¥½éœ€è¦äº†è§£
# 1ã€projectã€targetä¹‹é—´çš„ä¾èµ–ã€ç»§æ‰¿å…³ç³»
# 2ã€Xcode project-Configurationã€project-Build Settings
# 3ã€Xocde target-Build Settings
# 4ã€pod installèƒŒåéƒ½åšäº†å“ªäº›äº‹æƒ…

# pre_install é˜¶æ®µ
#pre_install do |installer|
#end
#
## post_installé˜¶æ®µ
#
#post_install do |installer|
#
#  puts "â•Ÿ installer"
#  installer.instance_variables.each do |variableName|
#      puts "  â•Ÿ #{variableName}"
#  end
#
#  puts "#{installer.pod_targets}"
#  puts "#{installer.pods_project}"
#  puts "#{installer.generated_projects}"
#  puts "#{installer.generated_pod_targets}"
#
#  puts "  â•Ÿ installer.public_methods"
#  installer.public_methods.each do |method|
#      puts "    â”£ #{method}"
#  end
#  puts "##### post_install end #####"
#
#  # 1ã€è·å–åˆ° å®¿ä¸»Projectï¼ˆå› ä¸ºç›®å‰æˆ‘ä»¬çš„å®¿ä¸»æ˜¯å•Projectå¤šTargetçš„ç»“æ„ï¼‰
#  project = installer.generated_projects.at(0)
#
#  # 2ã€è·å–åˆ° å®¿ä¸»Project ä¸‹é¢æ‰€æœ‰çš„ Target
#  project_targets = project.targets
#
#  # 3ã€è·å–åˆ° Pods Project
#  pods_project = installer.pods_project
#
#  # 4ã€è·å–åˆ° Pods Project ä¸‹é¢ç®¡ç†çš„æ‰€æœ‰ Pod Target
#  pods_targets = pods_project.targets
#
#  # puts ä¸ºåœ¨ç»ˆç«¯æ‰“å°æ–¹æ³•
#  puts "##### post_install start #####"
#
#  installer.generated_projects.each do |project|
#
#    project.targets.each do |target|
#
#      target.build_configurations do |config|
#
#        config.build_settings['OTHER_SWIFT_FLAGS'] ||= ['$(inherited) -D ']
#
#        if config.name.include?("Debug")
#          config.build_settings['OTHER_SWIFT_FLAGS'] << 'DEBUG'
#          end
#
#        end
#
#      end
#
#  end

# è„šæœ¬1ï¼šå®¿ä¸» Project All Targetsã€è‡ªå®šä¹‰æ·»åŠ æˆ–æ›´æ–° Build Settings å‚æ•°ã€‘

#  project_targets.each do |target|
#
#    target.build_configurations.each do |config|
#
#      config.build_settings['OTHER_SWIFT_FLAGS'] ||= ['$(inherited) -D ']
#
#      if config.name.include?("Debug")
#
#        # æ·»åŠ  Swift Other Flags è‡ªå®šä¹‰é¢„å¤„ç†å¤´å‚æ•°
#        config.build_settings['OTHER_SWIFT_FLAGS'] << 'RSH'
#
#        end
#
#      end
#
#    end

# è„šæœ¬2ï¼šPods Project All Targetsã€è‡ªå®šä¹‰æ·»åŠ æˆ–æ›´æ–° Build Settings å‚æ•°ã€‘

#  pods_targets.each do |target|
#
#    target.build_configurations.each do |config|
#
#      config.build_settings['OTHER_SWIFT_FLAGS'] ||= ['$(inherited) -D ']
#
#      if config.name.include?("Debug")
#
#        # æ·»åŠ  Swift Other Flags è‡ªå®šä¹‰é¢„å¤„ç†å¤´å‚æ•°
#        config.build_settings['OTHER_SWIFT_FLAGS'] << 'RSH'
#
#        end
#
#      end
#
#    end

#  end
